### Кросс-доменные запросы (Cross-Origin Requests)

- CORS = Cross-Origin Resource Sharing (совместное использование ресурсов между разными источниками)

- "CORS — это механизм, основанный на HTTP-заголовках, который позволяет серверам указывать, из каких источников браузеры могут делать запросы"

- В целях безопасности, находясь на сайте X, CORS не позволяет скриптам запрашивать данные с сайта Y
  - Это также влияет на некоторые другие аспекты, но мы сосредоточимся на запросах, сделанных с помощью fetch() к API-эндпоинтам
  - Это называется политикой одного источника (same-origin policy)

- Если вы находитесь на сайте ruslantissen.com, вы не можете получить доступ к my-bank.com
  - Возможно, вы вошли в свой банк, и ruslantissen.com мог бы загрузить все ваши данные!
  - ruslantissen.com не может загрузить ВАШ Facebook или ВАШ банк, используя ВАШ браузер

- Запросы между одним и тем же источником разрешены
  - находясь на facebook.com, вы можете делать запросы к facebook.com/user

- Источник сайта состоит из
  - схемы или протокола (http / https) - http://ruslantissen.com vs https://ruslantissen.com
  - имени хоста / доменного имени (localhost / facebook.com / mybank.de)
  - порта (80, 3000, 8080, 5501 и т.д.) - http://ruslantissen.com:3000 vs http://ruslantissen.com:8080

- Однако, серверы могут специально разрешить запросы к их данным с любого источника ИЛИ с конкретных источников
  - Это обычно делается для публичных API, таких как API для получения сообщений Twitter
  - Серверы также могут разрешить, например, GET-запросы, но не POST-запросы

- Браузеры фактически проверяют, разрешает ли сервер кросс-доменные запросы, делая "префлайт-запрос" (preflight request)
  - В основном эти вещи автоматические, так что не беспокойтесь об этом :)

- Обход CORS: Использование прокси-скрипта / прокси-сервера для разработки, `cors-anywhere`
  - `fetch("https://some-random-proxy.com/api.facebook.com/user")`

### Сохранение данных (в браузере)

- Web Storage API
  - Два способа сохранения данных в браузере: `localStorage` и `sessionStorage`
  - Оба привязаны к домену (скорее всего :D)

- ОЧЕНЬ ПОХОЖИ
  - данные сохраняются в виде пар ключ/значение строк

  - `Storage.setItem(<key>, <value>)`
  - `Storage.getItem(<key>);`
  - `Storage.removeItem(<key>);`
  - `Storage.clear()`

### SessionStorage

- Страница загружается во вкладке; это создает "сессию вкладки" для этой вкладки

- Эти "сессии вкладки" длятся, пока вкладка открыта
    - Перезагрузка страницы не удаляет эту сессию
    - Изменения страниц (в пределах одного домена) не удаляют эту сессию
    - Сессия очищается / удаляется при закрытии вкладки

- Открытие нескольких вкладок даже с одним и тем же доменом создает новые сессии SessionStorage
- Дублирование вкладки дублирует сессию sessionStorage этой вкладки

### LocalStorage

- как sessionStorage, но....
  - не истекает при закрытии вкладки
  - разделяется между вкладками (в пределах одного домена)

### Примеры использования

- Пользователь переключает язык сайта --> мы сохраняем текущий язык в localStorage
- Пользователь принимает файлы cookie --> мы сохраняем выбор "принять" в localStorage
- Пользователь переключает тему сайта --> мы сохраняем текущую тему в localStorage
- Пользователь входит в систему --> мы сохраняем текущего пользователя в localStorage (мы сделаем это позже!)
- Пользователь пишет что-то в поле ввода, и мы хотим сохранить это значение (в sessionStorage?)

  ```js
  // Пример использования: сохранение значения текстового поля ввода в sessionStorage
  // и загрузка его из sessionStorage при загрузке страницы
  const input = document.querySelector("#content")
  const oldValue = sessionStorage.getItem("text-input")
  if (oldValue) {
    input.value = oldValue
  }

  input.addEventListener("change", () => {
    sessionStorage.setItem("text-input", input.value)
  })
  ```